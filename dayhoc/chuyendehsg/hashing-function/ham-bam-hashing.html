<html xmlns:m="http://www.w3.org/1998/Math/MathML">
<head>
 <meta charset="utf8"/>
 <title>Hashing function - Hàm băm</title>
 <meta name="author" value="Tran Huu Nam"/>
 <link rel="stylesheet" href="../../inc/chung.css">
 <link rel="stylesheet" href="../../inc/mathjax/mathjax_styles.css">
 <script src="../../inc/mathjax/tex-mml-chtml.js" id="MathJax-script" async></script>
 <script src="../../inc/jquery.min.js" type="text/javascript"></script>
 <script src="../../inc/jquery-ui.min.js" type="text/javascript"></script>
 <link rel="stylesheet" href="../../inc/jquery-ui.min.css">
 <script src="../../inc/chung.js" type="text/javascript"></script>
 
</head>
<body>

<h1>Hashing function - Hàm băm</h1>
<h2>1. Khái niệm:</h2>

<p>Để so sánh hai xâu, ta có cách làm đơn giản là duyệt lần lượt từng kí tự ở cả hai xâu để so sánh.</p>

<p>Với cách này, độ phức tạp là O(min(n1,n2)) với n1,n2 là độ dài tương ứng của xâu 1 và xâu 2.</p>

<p>Ta có ý tưởng tốt hơn như sau: chuyển đổi mỗi xâu tương ứng thành một số nguyên, rồi so sánh 2 số nguyên với nhau.</p>

<p>Độ phức tạp chỉ còn là O(1).</p>

<p>Hàm để chuyển xâu thành số nguyên là hàm băm (Hash function).</p>

<p>Nếu hai xâu s = t thì hash(s) = hash(t).</p>


<h2>2. Hàm băm:</h2>

<p>Hàm băm của xâu thường được sử dụng là:</p>

\[ hash(s) = s_0 + s_1 \cdot p + s_2 \cdot p^2 + ... + s_{n-1} \cdot p^{n-1} \mod M \]
\[= \sum_{i=0}^{n-1} s_i \cdot p^i \mod M \]

<p>Với P và M là các số nguyên được chọn trước, gần bằng length(s).</p>

<p>Ví dụ nếu trong xâu chỉ gồm các kí tự in thường thì P=31. Nếu trong xâu có cả chữ thường lẫn hoa thì P=53.</p>

<p>M phải là một số lớn vì xác xuất để hai xâu ngẫu nhiên khác nhau có mã hash trùng nhau là ≈1/m.</p>

<p>Trong thực tế, ta thường chọn M là một <em>số nguyên tố</em> lớn, chẳng hạn \(M=10^9+9\). Đây là một số nguyên lớn nhưng đủ nhỏ để thực hiện phép nhân hai giá trị bằng cách sử dụng số nguyên 64 bit.</p>
<p>Hàm băm đối với xâu chỉ chứa các chữ thường</p>
<p>Ví dụ: s="abac";</p>
<p>Thực tế s[0]='a'=97 nhưng ta sẽ quy ước lại 'a'=1, 'b'=2,...</p>
<p>hash(s) = \(a + b*31 + a*31^2 + c*31^3 \mod M = 1 + 2*31 + 1*31^2 + 3*31^3 \mod M = 90397\)</p>
<p>Cách tính khác: hash(s) = \(a + 31*(b + 31*(a + c*31)) = 1 + 31*(2 + 31*(1 + 3*31)) = 3121_{31}\) (số ngược của s trong hệ đếm cơ số 31)</p>
<pre>
<span class="style5">long long </span><span class="style11">hambam</span><span class="style10">(</span><span class="style16">string </span><span class="style11">s</span><span class="style10">) {
    </span><span class="style5">const int </span><span class="style11">p </span><span class="style10">= </span><span class="style4">31</span><span class="style10">;
    </span><span class="style5">const int </span><span class="style11">m </span><span class="style10">= </span><span class="style4">1e9 </span><span class="style10">+ </span><span class="style4">9</span><span class="style10">;
    </span><span class="style5">long long </span><span class="style11">kq </span><span class="style10">= </span><span class="style4">0</span><span class="style10">;
    </span><span class="style5">long long </span><span class="style11">pm </span><span class="style10">= </span><span class="style4">1</span><span class="style10">;
    </span><span class="style5">for </span><span class="style10">(</span><span class="style5">int </span><span class="style11">i</span><span class="style10">=</span><span class="style4">0</span><span class="style10">; </span><span class="style11">i</span><span class="style10">&lt;</span><span class="style11">s</span><span class="style10">.</span><span class="style11">length</span><span class="style10">(); </span><span class="style11">i</span><span class="style10">++) {
        </span><span class="style11">kq </span><span class="style10">= (</span><span class="style11">kq </span><span class="style10">+ (</span><span class="style11">s</span><span class="style10">[</span><span class="style11">i</span><span class="style10">] - </span><span class="style7">'a' </span><span class="style10">+ </span><span class="style4">1</span><span class="style10">) * </span><span class="style11">pm</span><span class="style10">) % </span><span class="style11">m</span><span class="style10">;
        </span><span class="style11">pm </span><span class="style10">= (</span><span class="style11">pm </span><span class="style10">* </span><span class="style11">p</span><span class="style10">) % </span><span class="style11">m</span><span class="style10">;
    }
    </span><span class="style5">return </span><span class="style11">kq</span><span class="style10">;
}

</span>
</pre>
hoặc
<pre>
<span class="style5">long long </span><span class="style11">hambam</span><span class="style10">(</span><span class="style16">string </span><span class="style11">s</span><span class="style10">) {
    </span><span class="style5">const int </span><span class="style11">p </span><span class="style10">= </span><span class="style4">31</span><span class="style10">;
    </span><span class="style5">const int </span><span class="style11">m </span><span class="style10">= </span><span class="style4">1e9 </span><span class="style10">+ </span><span class="style4">9</span><span class="style10">;
    </span><span class="style5">long long </span><span class="style11">kq </span><span class="style10">= </span><span class="style4">0</span><span class="style10">;
    </span><span class="style5">for </span><span class="style10">(</span><span class="style5">int </span><span class="style11">i</span><span class="style10">=</span><span class="style11">s</span><span class="style10">.</span><span class="style11">length</span><span class="style10">()-</span><span class="style4">1</span><span class="style10">; </span><span class="style11">i</span><span class="style10">&gt;=</span><span class="style4">0</span><span class="style10">; </span><span class="style11">i</span><span class="style10">--) 
        </span><span class="style11">kq </span><span class="style10">= (</span><span class="style11">kq </span><span class="style10">* </span><span class="style11">p </span><span class="style10">+ (</span><span class="style11">s</span><span class="style10">[</span><span class="style11">i</span><span class="style10">] - </span><span class="style4">96</span><span class="style10">) ) % </span><span class="style11">m</span><span class="style10">;
    </span><span class="style5">return </span><span class="style11">kq</span><span class="style10">;
}
</span>
</pre>


Bài tập:

<ul>
	<li><a href="http://www.spoj.com/problems/NHAY/">A Needle in the Haystack - SPOJ</a></li>
	<li><a href="http://codeforces.com/problemset/problem/154/C">Double Profiles - Codeforces</a></li>
	<li><a href="http://codeforces.com/problemset/problem/126/B">Password - Codeforces</a></li>
	<li><a href="http://www.spoj.com/problems/SUB_PROB/">SUB_PROB - SPOJ</a></li>
	<li><a href="https://www.codechef.com/problems/INSQ15_A">INSQ15_A</a></li>
	<li><a href="http://www.spoj.com/problems/ADACLEAN/">SPOJ - Ada and Spring Cleaning</a></li>
	<li><a href="http://codeforces.com/gym/101466/problem/E">GYM - Text Editor</a></li>
	<li><a href="https://uva.onlinejudge.org/index.php?option=onlinejudge&amp;page=show_problem&amp;problem=3163">12012 - Detection of Extraterrestrial</a></li>
	<li><a href="http://codeforces.com/contest/727/problem/E">Codeforces - Games on a CD</a></li>
	<li><a href="https://uva.onlinejudge.org/index.php?option=com_onlinejudge&amp;Itemid=8&amp;page=show_problem&amp;problem=2955">UVA 11855 - Buzzwords</a></li>
	<li><a href="http://codeforces.com/contest/752/problem/D">Codeforces - Santa Claus and a Palindrome</a></li>
	<li><a href="http://codeforces.com/contest/825/problem/F">Codeforces - String Compression</a></li>
	<li><a href="http://codeforces.com/contest/835/problem/D">Codeforces - Palindromic Characteristics</a></li>
	<li><a href="http://www.spoj.com/problems/CF25E/">SPOJ - Test</a></li>
	<li><a href="http://codeforces.com/contest/7/problem/D">Codeforces - Palindrome Degree</a></li>
	<li><a href="http://codeforces.com/contest/19/problem/C">Codeforces - Deletion of Repeats</a></li>
	<li><a href="https://www.hackerrank.com/contests/womens-codesprint-5/challenges/gift-boxes">HackerRank - Gift Boxes</a></li>
</ul>

</body>
</html>