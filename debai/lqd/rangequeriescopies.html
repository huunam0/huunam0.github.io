<div class="problem-title">
<h2 style="color:#393630; display: inline-block">Range Queries and Copies</h2>
</div><div class="content-description screen">
<div><p>Cho một tập các mảng mà ban đầu chỉ có một mảng. Nhiệm vụ của bạn là thực hiện các truy vấn sau:</p>
<ul>
<li>\(1\) \(k\) \(a\) \(x\): Thay đổi phần tử thứ \(a\) ở mảng thứ \(k\) thành \(x\).</li>
<li>\(2\) \(k\) \(a\) \(b\): Tính tổng các phần tử trong đoạn \([a, b]\) ở mảng \(k\).</li>
<li>\(3\) \(k\): Tạo một bản sao của mảng \(k\) và đưa vào cuối tập các mảng.</li>
</ul>
<p><strong>Dữ liệu vào</strong>:</p>
<ul>
<li>Dòng thứ nhất gồm hai số nguyên dương \(N, Q\): kích thước từng mảng và số truy vấn.</li>
<li>Dòng thứ hai gồm \(N\) số nguyên dương \(A_1, A_2, ..., A_N\) \((1 \leq A_i \leq 10^9)\).</li>
<li>\(Q\) dòng tiếp theo, mỗi dòng là một truy vấn thuộc một trong ba dạng sau:<ul>
<li>\(1\) \(k\) \(a\) \(b\) \((1 \leq k \leq\) số mảng hiện tại, \(1 \leq a \leq b \leq N)\).</li>
<li>\(2\) \(k\) \(a\) \(b\) \((1 \leq k \leq\) số mảng hiện tại, \(1 \leq a \leq b \leq N)\).</li>
<li>\(3\) \(k\) (\(1 \leq k \leq\) số mảng hiện tại).</li>
</ul>
</li>
</ul>
<p><strong>Kết quả</strong>: In ra kết quả cho các truy vấn \(2\).</p>
<p><strong>Ràng buộc</strong>:</p>
<ul>
<li>Subtask 1 \((50\%)\): \(N, Q \leq 2.10^3\).</li>
<li>Subtask 2 \((50\%)\): \(N, Q \leq 2.10^5\).</li>
</ul>
<p><strong>Ví dụ</strong>:</p>
<p><strong>Input</strong>:</p>
<pre><code>5 6
2 3 1 2 5
3 1
2 1 1 5
2 2 1 5
1 2 2 5
2 1 1 5
2 2 1 5</code></pre>
<p><strong>Output</strong>:</p>
<pre><code>13
13
13
15</code></pre>
<p><strong>CSES</strong></p>
</div>
<hr/>
</div>